<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¶‚è£…è½¦é—´èƒ½è€—é¢„æµ‹ç³»ç»Ÿ</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-green: rgb(0, 45, 40);
            --primary-green-light: rgb(0, 65, 60);
            --accent-gold: rgb(206, 164, 114);
            --accent-amber: rgb(186, 144, 94);
            --bg-dark: rgb(15, 15, 18);
            --bg-card: rgb(25, 30, 35);
            --text-primary: rgb(245, 248, 250);
            --text-secondary: rgb(160, 174, 192);
            --border-color: rgba(0, 65, 60, 0.3);

            --color-pretreatment: rgba(66, 153, 225, 0.2);
            --color-ecoat: rgba(159, 122, 234, 0.2);
            --color-sealer: rgba(236, 201, 75, 0.2);
            --color-topcoat: rgba(245, 101, 101, 0.2);
            --color-auxiliary: rgba(72, 187, 120, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, var(--bg-dark) 0%, rgb(10, 20, 25) 100%);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 0.75rem;
            font-size: 15px;
            overflow-x: hidden;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        /* Workshop Selection Screen */
        .workshop-selection-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, var(--bg-dark) 0%, rgb(10, 20, 25) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.5s ease-out;
        }

        .workshop-selection-screen.hidden {
            display: none;
        }

        .workshop-selection-content {
            text-align: center;
            max-width: 600px;
            padding: 2rem;
        }

        .workshop-selection-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent-gold);
            margin-bottom: 3rem;
        }

        .workshop-buttons {
            display: flex;
            gap: 2rem;
            justify-content: center;
        }

        .workshop-btn {
            padding: 2rem 3rem;
            background: linear-gradient(135deg, var(--primary-green) 0%, var(--primary-green-light) 100%);
            border: 2px solid var(--accent-gold);
            border-radius: 16px;
            color: var(--text-primary);
            font-size: 1.5rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 45, 40, 0.4);
        }

        .workshop-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(206, 164, 114, 0.4);
            border-color: var(--accent-amber);
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Main Content */
        .main-content {
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease-out;
        }

        .main-content.visible {
            opacity: 1;
            pointer-events: all;
        }

        header {
            text-align: center;
            margin-bottom: 1rem;
            padding: 1rem;
            background: linear-gradient(135deg, var(--primary-green) 0%, var(--primary-green-light) 100%);
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 45, 40, 0.4);
            position: relative;
        }

        h1 {
            font-size: 1.5rem;
            font-weight: 700;
            display: inline-block;
            margin-right: 1rem;
        }

        .workshop-badge {
            display: inline-block;
            padding: 0.4rem 1rem;
            background: var(--accent-gold);
            color: var(--primary-green);
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 700;
        }

        .header-actions {
            margin-top: 0.75rem;
            display: flex;
            gap: 0.75rem;
            justify-content: center;
        }

        .header-btn {
            padding: 0.4rem 1rem;
            background: rgba(206, 164, 114, 0.2);
            border: 1px solid var(--accent-gold);
            border-radius: 6px;
            color: var(--accent-gold);
            text-decoration: none;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .header-btn:hover {
            background: var(--accent-gold);
            color: var(--primary-green);
        }

        /* Usage Instructions */
        .usage-instructions {
            background: var(--bg-card);
            border-radius: 10px;
            padding: 0.75rem 1rem;
            margin-bottom: 1rem;
            border: 1px solid var(--border-color);
            font-size: 0.75rem;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .usage-instructions strong {
            color: var(--accent-gold);
            writing-mode: horizontal-tb;
        }

        .usage-steps {
            display: flex;
            gap: 1.5rem;
            justify-content: center;
            margin-top: 0.5rem;
        }

        .usage-step {
            writing-mode: vertical-rl;
            text-orientation: upright;
            letter-spacing: 0.1em;
            font-size: 0.7rem;
            padding: 0.5rem 0;
        }

        /* Process Flow Diagram */
        .flow-diagram {
            background: var(--bg-card);
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
            border: 1px solid var(--border-color);
            overflow-x: auto;
        }

        .flow-container {
            display: flex;
            gap: 0.5rem;
            min-width: max-content;
            padding: 0.5rem 0;
        }

        .flow-section {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .flow-section-label {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--accent-gold);
            text-align: center;
            padding: 0.3rem;
            border-radius: 4px;
            background: rgba(206, 164, 114, 0.1);
        }

        .flow-equipment-row {
            display: flex;
            gap: 0.5rem;
        }

        .flow-equipment {
            padding: 0.6rem 1rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            white-space: nowrap;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .flow-equipment:hover {
            transform: translateY(-2px);
            border-color: var(--accent-gold);
        }

        .flow-equipment.selected {
            border-color: var(--accent-gold);
            box-shadow: 0 4px 12px rgba(206, 164, 114, 0.3);
        }

        .flow-pretreatment { background: var(--color-pretreatment); }
        .flow-ecoat { background: var(--color-ecoat); }
        .flow-sealer { background: var(--color-sealer); }
        .flow-topcoat { background: var(--color-topcoat); }
        .flow-auxiliary { background: var(--color-auxiliary); }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        @media (max-width: 1400px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: var(--bg-card);
            border-radius: 10px;
            padding: 1rem;
            border: 1px solid var(--border-color);
        }

        .card-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: var(--accent-gold);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .process-section {
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .process-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .process-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.6rem;
            padding: 0.4rem 0.6rem;
            background: rgba(0, 45, 40, 0.2);
            border-radius: 6px;
        }

        .process-title-wrapper {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .process-checkbox {
            width: 16px;
            height: 16px;
            cursor: pointer;
            accent-color: var(--accent-gold);
        }

        .process-title {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--accent-gold);
        }

        .batch-time-control {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            font-size: 0.7rem;
        }

        .batch-time-input {
            width: 45px;
            padding: 0.2rem 0.4rem;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            color: var(--text-primary);
            font-size: 0.7rem;
            font-family: 'JetBrains Mono', monospace;
            text-align: center;
        }

        .batch-apply-btn {
            padding: 0.2rem 0.6rem;
            background: var(--accent-gold);
            border: none;
            border-radius: 4px;
            color: var(--primary-green);
            font-size: 0.7rem;
            font-weight: 600;
            cursor: pointer;
        }

        .equipment-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 0.6rem;
        }

        .equipment-checkbox {
            display: none;
        }

        .equipment-label {
            display: flex;
            flex-direction: column;
            padding: 0.6rem;
            background: rgba(0, 45, 40, 0.2);
            border: 2px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 100px;
        }

        .equipment-checkbox:checked + .equipment-label {
            background: linear-gradient(135deg, var(--primary-green) 0%, var(--primary-green-light) 100%);
            border-color: var(--accent-gold);
        }

        .equipment-name {
            font-weight: 600;
            font-size: 0.8rem;
            margin-bottom: 0.3rem;
        }

        .equipment-info {
            font-size: 0.65rem;
            color: var(--text-secondary);
            margin-bottom: 0.2rem;
            line-height: 1.2;
        }

        .equipment-checkbox:checked + .equipment-label .equipment-info {
            color: var(--accent-gold);
        }

        .equipment-time-input {
            margin-top: auto;
        }

        .equipment-time-label {
            font-size: 0.6rem;
            color: var(--text-secondary);
            margin-bottom: 0.2rem;
        }

        .time-input-wrapper {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .time-input {
            width: 45px;
            padding: 0.25rem;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            color: var(--text-primary);
            font-size: 0.7rem;
            font-family: 'JetBrains Mono', monospace;
            text-align: center;
        }

        .time-unit {
            font-size: 0.6rem;
            color: var(--text-secondary);
        }

        .checkmark {
            position: absolute;
            top: 0.6rem;
            right: 0.6rem;
            width: 18px;
            height: 18px;
            border: 2px solid var(--border-color);
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .equipment-checkbox:checked + .equipment-label .checkmark {
            background: var(--accent-gold);
            border-color: var(--accent-gold);
        }

        .checkmark::after {
            content: '';
            position: absolute;
            left: 50%;
            top: 50%;
            width: 4px;
            height: 8px;
            border: solid var(--primary-green);
            border-width: 0 2px 2px 0;
            transform: translate(-50%, -60%) rotate(45deg) scale(0);
            transition: transform 0.3s ease;
        }

        .equipment-checkbox:checked + .equipment-label .checkmark::after {
            transform: translate(-50%, -60%) rotate(45deg) scale(1);
        }

        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
            gap: 0.6rem;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 0.3rem;
        }

        .input-label {
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .input-field {
            width: 100%;
            padding: 0.55rem 0.65rem;
            background: rgba(0, 45, 40, 0.2);
            border: 2px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 0.85rem;
            font-family: 'JetBrains Mono', monospace;
        }

        .input-unit {
            position: absolute;
            right: 0.65rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.7rem;
            color: var(--text-secondary);
        }

        .section-label {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 0.6rem;
            text-transform: uppercase;
        }

        .divider {
            height: 1px;
            background: var(--border-color);
            margin: 1rem 0;
        }

        .calculate-btn {
            width: 100%;
            padding: 0.75rem;
            background: linear-gradient(135deg, var(--accent-gold) 0%, var(--accent-amber) 100%);
            border: none;
            border-radius: 8px;
            color: var(--primary-green);
            font-size: 0.9rem;
            font-weight: 700;
            cursor: pointer;
            text-transform: uppercase;
        }

        .results-card {
            background: var(--bg-card);
            border-radius: 10px;
            padding: 1rem;
            border: 1px solid var(--border-color);
        }

        .result-category {
            background: rgba(0, 45, 40, 0.2);
            border-radius: 8px;
            padding: 0.9rem;
            border: 1px solid var(--border-color);
            margin-bottom: 0.9rem;
        }

        .result-category-title {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--accent-gold);
            margin-bottom: 0.6rem;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 0.55rem;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 6px;
            margin-bottom: 0.5rem;
        }

        .result-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .result-value {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            font-size: 0.85rem;
        }

        .result-value.highlight {
            color: var(--accent-gold);
            font-size: 0.9rem;
        }

        .total-item {
            display: flex;
            justify-content: space-between;
            padding: 0.65rem;
            background: linear-gradient(135deg, var(--primary-green) 0%, var(--primary-green-light) 100%);
            border-radius: 8px;
            margin-bottom: 0.5rem;
        }

        .total-item:last-child {
            background: linear-gradient(135deg, var(--accent-gold) 0%, var(--accent-amber) 100%);
        }

        .total-label {
            font-size: 0.85rem;
            font-weight: 600;
        }

        .total-value {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700;
            font-size: 1.15rem;
        }

        .total-item:last-child .total-value {
            color: var(--primary-green);
        }

        .scrollable-content {
            max-height: 55vh;
            overflow-y: auto;
            padding-right: 0.5rem;
        }

        .scrollable-content::-webkit-scrollbar {
            width: 5px;
        }

        .scrollable-content::-webkit-scrollbar-track {
            background: rgba(0, 45, 40, 0.2);
            border-radius: 3px;
        }

        .scrollable-content::-webkit-scrollbar-thumb {
            background: var(--accent-gold);
            border-radius: 3px;
        }

        .input-wrapper {
            position: relative;
        }
    </style>
</head>
<body>
    <!-- Workshop Selection Screen -->
    <div class="workshop-selection-screen" id="workshop-selection">
        <div class="workshop-selection-content">
            <div class="workshop-selection-title">é€‰æ‹©è½¦é—´</div>
            <div class="workshop-buttons">
                <button class="workshop-btn" onclick="selectWorkshop(1)">ä¸€è½¦é—´</button>
                <button class="workshop-btn" onclick="selectWorkshop(2)">äºŒè½¦é—´</button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container main-content" id="main-content">
        <header>
            <h1>æ¶‚è£…è½¦é—´èƒ½è€—é¢„æµ‹ç³»ç»Ÿ</h1>
            <span class="workshop-badge" id="workshop-badge">æœªé€‰æ‹©</span>
            <div class="header-actions">
                <a href="#" class="header-btn" id="data-link" onclick="openDataPage()">ğŸ“Š è®¾å¤‡åŸºç¡€èƒ½è€—</a>
                <button class="header-btn" onclick="changeWorkshop()">ğŸ”„ åˆ‡æ¢è½¦é—´</button>
            </div>
        </header>

        <!-- Usage Instructions -->
        <div class="usage-instructions">
            <strong>ğŸ“– ä½¿ç”¨è¯´æ˜ï¼š</strong>
            <div class="usage-steps">
                <div class="usage-step">â‘  åœ¨æµç¨‹å›¾æˆ–åˆ—è¡¨ä¸­é€‰æ‹©éœ€è¦çš„ç”Ÿäº§è®¾å¤‡</div>
                <div class="usage-step">â‘¡ è®¾ç½®æ¯ä¸ªè®¾å¤‡çš„ç”Ÿäº§æ—¶é—´ï¼ˆä¸åŒ…å«å‡æ¸©é™æ¸©ï¼‰</div>
                <div class="usage-step">â‘¢ è¾“å…¥ç¯å¢ƒæ¸©åº¦ã€æ—¥äº§é‡ã€èƒ½æºå•ä»·</div>
                <div class="usage-step">â‘£ ç‚¹å‡»"è®¡ç®—èƒ½è€—é¢„æµ‹"æŸ¥çœ‹ç»“æœ</div>
            </div>
        </div>

        <!-- Process Flow Diagram -->
        <div class="flow-diagram">
            <div class="flow-container" id="flow-container">
                <!-- Dynamically generated -->
            </div>
        </div>

        <div class="main-grid">
            <!-- Left Panel -->
            <div>
                <div class="card">
                    <h2 class="card-title">ç”Ÿäº§åŒºåŸŸé€‰æ‹©</h2>
                    <div class="scrollable-content" id="equipment-sections">
                        <!-- Dynamically generated -->
                    </div>
                </div>

                <div class="card" style="margin-top: 1rem;">
                    <h2 class="card-title">è¿è¡Œå‚æ•°</h2>
                    <div class="section">
                        <div class="section-label">ğŸŒ¡ï¸ ç¯å¢ƒæ¡ä»¶</div>
                        <div class="input-grid">
                            <div class="input-group">
                                <label class="input-label">ç¯å¢ƒæ¸©åº¦</label>
                                <div class="input-wrapper">
                                    <input type="number" id="ambient-temp" class="input-field" value="20" step="0.5">
                                    <span class="input-unit">Â°C</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="divider"></div>
                    <div class="section">
                        <div class="section-label">ğŸ­ ç”Ÿäº§å‚æ•°</div>
                        <div class="input-grid">
                            <div class="input-group">
                                <label class="input-label">æ—¥äº§é‡</label>
                                <div class="input-wrapper">
                                    <input type="number" id="daily-output" class="input-field" value="100" step="1">
                                    <span class="input-unit">å°/æ—¥</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="divider"></div>
                    <div class="section">
                        <div class="section-label">ğŸ’° èƒ½æºå•ä»·</div>
                        <div class="input-grid">
                            <div class="input-group">
                                <label class="input-label">å·¥ä¸šæ°´</label>
                                <div class="input-wrapper">
                                    <input type="number" id="water-price" class="input-field" value="5.5" step="0.1">
                                    <span class="input-unit">å…ƒ/å¨</span>
                                </div>
                            </div>
                            <div class="input-group">
                                <label class="input-label">å¤©ç„¶æ°”</label>
                                <div class="input-wrapper">
                                    <input type="number" id="gas-price" class="input-field" value="3.2" step="0.1">
                                    <span class="input-unit">å…ƒ/mÂ³</span>
                                </div>
                            </div>
                            <div class="input-group">
                                <label class="input-label">ç”µä»·</label>
                                <div class="input-wrapper">
                                    <input type="number" id="electricity-price" class="input-field" value="0.8" step="0.01">
                                    <span class="input-unit">å…ƒ/kWh</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="margin-top: 1rem;">
                        <button class="calculate-btn" onclick="calculateEnergy()">è®¡ç®—èƒ½è€—é¢„æµ‹</button>
                    </div>
                </div>
            </div>

            <!-- Right Panel -->
            <div>
                <div class="results-card">
                    <h2 class="card-title">é¢„æµ‹ç»“æœ</h2>
                    <div id="results">
                        <div class="result-category">
                            <div class="result-category-title">ğŸ’§ å·¥ä¸šæ°´ç”¨é‡</div>
                            <div class="result-item">
                                <span class="result-label">æ—¥ç”¨é‡</span>
                                <span class="result-value" id="water-daily">--</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">å•è½¦ç”¨é‡</span>
                                <span class="result-value" id="water-unit">--</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">æ—¥è´¹ç”¨</span>
                                <span class="result-value highlight" id="water-cost">--</span>
                            </div>
                        </div>

                        <div class="result-category">
                            <div class="result-category-title">ğŸ”¥ å¤©ç„¶æ°”ç”¨é‡</div>
                            <div class="result-item">
                                <span class="result-label">æ—¥ç”¨é‡</span>
                                <span class="result-value" id="gas-daily">--</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">å•è½¦ç”¨é‡</span>
                                <span class="result-value" id="gas-unit">--</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">æ—¥è´¹ç”¨</span>
                                <span class="result-value highlight" id="gas-cost">--</span>
                            </div>
                        </div>

                        <div class="result-category">
                            <div class="result-category-title">âš¡ ç”µèƒ½ç”¨é‡</div>
                            <div class="result-item">
                                <span class="result-label">æ—¥ç”¨é‡</span>
                                <span class="result-value" id="electricity-daily">--</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">å•è½¦ç”¨é‡</span>
                                <span class="result-value" id="electricity-unit">--</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">æ—¥è´¹ç”¨</span>
                                <span class="result-value highlight" id="electricity-cost">--</span>
                            </div>
                        </div>

                        <div class="total-item">
                            <span class="total-label">æ—¥æ€»èƒ½è€—è´¹ç”¨</span>
                            <span class="total-value" id="total-daily-cost">--</span>
                        </div>
                        <div class="total-item">
                            <span class="total-label">å•è½¦èƒ½è€—æˆæœ¬</span>
                            <span class="total-value" id="unit-cost">--</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="workshop-data.js"></script>
    <script>
        let currentWorkshop = null;

        function selectWorkshop(workshopNum) {
            currentWorkshop = workshopNum;
            document.getElementById('workshop-selection').classList.add('hidden');
            document.getElementById('main-content').classList.add('visible');
            document.getElementById('workshop-badge').textContent = workshopNum === 1 ? 'ä¸€è½¦é—´' : 'äºŒè½¦é—´';
            loadWorkshopData();
        }

        function changeWorkshop() {
            document.getElementById('workshop-selection').classList.remove('hidden');
            document.getElementById('main-content').classList.remove('visible');
        }

        function openDataPage() {
            if (!currentWorkshop) {
                alert('è¯·å…ˆé€‰æ‹©è½¦é—´');
                return;
            }
            window.open(`equipment-data.html?workshop=${currentWorkshop}`, '_blank');
        }

        function loadWorkshopData() {
            const data = currentWorkshop === 1 ? WORKSHOP1_DATA : WORKSHOP2_DATA;
            generateFlowDiagram(data);
            generateEquipmentSections(data);
        }

        function generateFlowDiagram(data) {
            const container = document.getElementById('flow-container');
            container.innerHTML = '';

            Object.entries(data).forEach(([sectionKey, section]) => {
                const flowSection = document.createElement('div');
                flowSection.className = 'flow-section';

                const label = document.createElement('div');
                label.className = 'flow-section-label';
                label.textContent = section.name;
                flowSection.appendChild(label);

                const equipmentRow = document.createElement('div');
                equipmentRow.className = 'flow-equipment-row';

                section.equipment.forEach(eq => {
                    const flowEq = document.createElement('div');
                    flowEq.className = `flow-equipment flow-${sectionKey}`;
                    flowEq.textContent = eq.name;
                    flowEq.dataset.equipmentId = eq.id;
                    flowEq.onclick = () => toggleFlowEquipment(eq.id);
                    equipmentRow.appendChild(flowEq);
                });

                flowSection.appendChild(equipmentRow);
                container.appendChild(flowSection);
            });
        }

        function toggleFlowEquipment(equipmentId) {
            const checkbox = document.getElementById(equipmentId);
            if (checkbox) {
                checkbox.checked = !checkbox.checked;
                updateFlowDiagram();
            }
        }

        function updateFlowDiagram() {
            document.querySelectorAll('.flow-equipment').forEach(flowEq => {
                const equipmentId = flowEq.dataset.equipmentId;
                const checkbox = document.getElementById(equipmentId);
                if (checkbox && checkbox.checked) {
                    flowEq.classList.add('selected');
                } else {
                    flowEq.classList.remove('selected');
                }
            });
        }

        function generateEquipmentSections(data) {
            const container = document.getElementById('equipment-sections');
            container.innerHTML = '';

            Object.entries(data).forEach(([sectionKey, section]) => {
                const processSection = document.createElement('div');
                processSection.className = 'process-section';

                const processHeader = document.createElement('div');
                processHeader.className = 'process-header';
                processHeader.innerHTML = `
                    <div class="process-title-wrapper">
                        <input type="checkbox" id="section-${sectionKey}" class="process-checkbox" onchange="toggleSection('${sectionKey}')">
                        <div class="process-title">${section.icon} ${section.name}</div>
                    </div>
                    <div class="batch-time-control">
                        <span>æ—¶é—´:</span>
                        <input type="number" id="batch-time-${sectionKey}" class="batch-time-input" value="8" min="0" step="0.5">
                        <span>h</span>
                        <button class="batch-apply-btn" onclick="applyBatchTime('${sectionKey}')">åº”ç”¨</button>
                    </div>
                `;

                const equipmentGrid = document.createElement('div');
                equipmentGrid.className = 'equipment-grid';

                section.equipment.forEach(eq => {
                    // å¦‚æœè®¾å¤‡æœ‰ lineBreak æ ‡è®°ï¼Œæ’å…¥æ¢è¡Œ
                    if (eq.lineBreak) {
                        const lineBreak = document.createElement('div');
                        lineBreak.style.width = '100%';
                        lineBreak.style.height = '0';
                        equipmentGrid.appendChild(lineBreak);
                    }

                    const equipmentItem = document.createElement('div');
                    equipmentItem.className = 'equipment-item';

                    // æ„å»ºå‡æ¸©é™æ¸©ä¿¡æ¯ï¼ˆåŒä¸€è¡Œæ˜¾ç¤ºï¼‰
                    let timeInfo = '';
                    if (eq.heatingTime > 0 && eq.coolingTime > 0) {
                        timeInfo = `<div class="equipment-info">å‡æ¸©: ${eq.heatingTime > 0 ? Math.floor(eq.heatingTime / 60) + 'h' + (eq.heatingTime % 60) + 'min' : 'æ— '} | é™æ¸©: ${eq.coolingTime}min</div>`;
                    } else if (eq.heatingTime > 0) {
                        timeInfo = `<div class="equipment-info">å‡æ¸©: ${eq.heatingTime > 0 ? Math.floor(eq.heatingTime / 60) + 'h' + (eq.heatingTime % 60) + 'min' : 'æ— '}</div>`;
                    } else if (eq.coolingTime > 0) {
                        timeInfo = `<div class="equipment-info">é™æ¸©: ${eq.coolingTime}min</div>`;
                    }

                    equipmentItem.innerHTML = `
                        <input type="checkbox" id="${eq.id}" class="equipment-checkbox"
                            data-heating-time="${eq.heatingTime}"
                            data-cooling-time="${eq.coolingTime || 0}"
                            data-section="${sectionKey}"
                            onchange="updateFlowDiagram()">
                        <label for="${eq.id}" class="equipment-label">
                            <div class="checkmark"></div>
                            <div class="equipment-name">${eq.name}</div>
                            ${timeInfo}
                            <div class="equipment-time-input">
                                <div class="equipment-time-label">ç”Ÿäº§æ—¶é—´</div>
                                <div class="time-input-wrapper">
                                    <input type="number" class="time-input" value="8" min="0" step="0.5" data-for="${eq.id}">
                                    <span class="time-unit">h</span>
                                </div>
                            </div>
                        </label>
                    `;
                    equipmentGrid.appendChild(equipmentItem);
                });

                processSection.appendChild(processHeader);
                processSection.appendChild(equipmentGrid);
                container.appendChild(processSection);
            });
        }

        function toggleSection(sectionName) {
            const sectionCheckbox = document.getElementById(`section-${sectionName}`);
            const equipmentCheckboxes = document.querySelectorAll(`.equipment-checkbox[data-section="${sectionName}"]`);
            equipmentCheckboxes.forEach(checkbox => {
                checkbox.checked = sectionCheckbox.checked;
            });
            updateFlowDiagram();
        }

        function applyBatchTime(sectionName) {
            const batchTimeInput = document.getElementById(`batch-time-${sectionName}`);
            const batchTime = parseFloat(batchTimeInput.value) || 8;
            const equipmentCheckboxes = document.querySelectorAll(`.equipment-checkbox[data-section="${sectionName}"]`);
            equipmentCheckboxes.forEach(checkbox => {
                const timeInput = document.querySelector(`.time-input[data-for="${checkbox.id}"]`);
                if (timeInput) {
                    timeInput.value = batchTime;
                }
            });
            const anySelected = Array.from(equipmentCheckboxes).some(cb => cb.checked);
            if (anySelected) {
                calculateEnergy();
            }
        }

        function calculateEnergy() {
            const selectedEquipment = [];
            document.querySelectorAll('.equipment-checkbox:checked').forEach(checkbox => {
                const productionTimeInput = document.querySelector(`.time-input[data-for="${checkbox.id}"]`);
                const productionTime = parseFloat(productionTimeInput.value) || 0;
                selectedEquipment.push({
                    id: checkbox.id,
                    heatingTime: parseInt(checkbox.dataset.heatingTime),
                    coolingTime: parseInt(checkbox.dataset.coolingTime) || 0,
                    productionTime: productionTime
                });
            });

            if (selectedEquipment.length === 0) {
                alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªè®¾å¤‡æ¨¡å—');
                return;
            }

            const data = currentWorkshop === 1 ? WORKSHOP1_DATA : WORKSHOP2_DATA;
            const ambientTemp = parseFloat(document.getElementById('ambient-temp').value);
            const dailyOutput = parseInt(document.getElementById('daily-output').value);
            const waterPrice = parseFloat(document.getElementById('water-price').value);
            const gasPrice = parseFloat(document.getElementById('gas-price').value);
            const electricityPrice = parseFloat(document.getElementById('electricity-price').value);

            const tempFactor = Math.max(1 - (ambientTemp - 20) * 0.015, 0.75);

            let totalWater = 0;
            let totalGas = 0;
            let totalElectricity = 0;

            selectedEquipment.forEach(equipment => {
                const coeff = findEquipmentCoeff(data, equipment.id);
                if (coeff) {
                    totalWater += coeff.water * dailyOutput;
                    totalGas += coeff.gas * dailyOutput;
                    totalElectricity += coeff.electricity * dailyOutput;

                    // Heating energy
                    if (equipment.heatingTime > 0) {
                        const heatingHours = equipment.heatingTime / 60;
                        const heatingGasRate = coeff.gas > 0.5 ? 50 : 20;
                        totalGas += heatingGasRate * heatingHours * tempFactor;
                        const heatingElectricityRate = coeff.electricity > 30 ? 100 : 40;
                        totalElectricity += heatingElectricityRate * heatingHours * tempFactor;
                        if (coeff.water > 0.3) {
                            totalWater += 0.5 * heatingHours;
                        }
                    }

                    // Cooling energy (fan power)
                    if (equipment.coolingTime > 0) {
                        const coolingHours = equipment.coolingTime / 60;
                        const coolingFanPower = 30; // kWh/hour for cooling fan
                        totalElectricity += coolingFanPower * coolingHours;
                    }
                }
            });

            totalGas *= tempFactor;
            totalElectricity *= (tempFactor * 0.95);

            const unitWater = totalWater / dailyOutput;
            const unitGas = totalGas / dailyOutput;
            const unitElectricity = totalElectricity / dailyOutput;

            const waterCost = totalWater * waterPrice;
            const gasCost = totalGas * gasPrice;
            const electricityCost = totalElectricity * electricityPrice;
            const totalDailyCost = waterCost + gasCost + electricityCost;
            const unitCost = totalDailyCost / dailyOutput;

            document.getElementById('water-daily').textContent = totalWater.toFixed(2) + ' å¨';
            document.getElementById('water-unit').textContent = unitWater.toFixed(3) + ' å¨/å°';
            document.getElementById('water-cost').textContent = 'Â¥ ' + waterCost.toFixed(2);

            document.getElementById('gas-daily').textContent = totalGas.toFixed(2) + ' mÂ³';
            document.getElementById('gas-unit').textContent = unitGas.toFixed(3) + ' mÂ³/å°';
            document.getElementById('gas-cost').textContent = 'Â¥ ' + gasCost.toFixed(2);

            document.getElementById('electricity-daily').textContent = totalElectricity.toFixed(2) + ' kWh';
            document.getElementById('electricity-unit').textContent = unitElectricity.toFixed(3) + ' kWh/å°';
            document.getElementById('electricity-cost').textContent = 'Â¥ ' + electricityCost.toFixed(2);

            document.getElementById('total-daily-cost').textContent = 'Â¥ ' + totalDailyCost.toFixed(2);
            document.getElementById('unit-cost').textContent = 'Â¥ ' + unitCost.toFixed(2) + ' /å°';
        }

        function findEquipmentCoeff(data, equipmentId) {
            for (const section of Object.values(data)) {
                const eq = section.equipment.find(e => e.id === equipmentId);
                if (eq) return eq;
            }
            return null;
        }
    </script>
</body>
</html>